{% extends "base.html" %}

{% block title %}Command Center{% endblock %}

{% block content %}
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 20px; margin-bottom: 30px;">
        <div class="form-card" style="flex-direction: row; align-items: center; border-left: 4px solid var(--primary-dark);">
            <div style="background: rgba(26, 35, 58, 0.1); width: 50px; height: 50px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 15px;">
                <i class="fas fa-cube" style="font-size: 24px; color: var(--primary-dark);"></i>
            </div>
            <div>
                <h3 style="margin: 0; font-size: 24px; font-weight: 800;">{{ daftar_proyek|length }}</h3>
                <span style="font-size: 12px; color: #888; text-transform: uppercase;">Saved Projects</span>
            </div>
        </div>
        <div class="form-card" style="flex-direction: row; align-items: center; border-left: 4px solid var(--success);">
            <div style="background: rgba(46, 204, 113, 0.1); width: 50px; height: 50px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 15px;">
                <i class="fas fa-wifi" style="font-size: 24px; color: var(--success);"></i>
            </div>
            <div>
                <h3 style="margin: 0; font-size: 24px; font-weight: 800;">ONLINE</h3>
                <span style="font-size: 12px; color: #888; text-transform: uppercase;">System Status</span>
            </div>
        </div>
        <div class="form-card" style="flex-direction: row; align-items: center; border-left: 4px solid var(--accent-teal);">
            <div style="background: rgba(0, 191, 165, 0.1); width: 50px; height: 50px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 15px;">
                <i class="fas fa-microchip" style="font-size: 24px; color: var(--accent-teal);"></i>
            </div>
            <div>
                <h3 style="margin: 0; font-size: 24px; font-weight: 800;">12</h3>
                <span style="font-size: 12px; color: #888; text-transform: uppercase;">Active Devices</span>
            </div>
        </div>
    </div>

    <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 30px; margin-bottom: 30px;">
        <div class="form-card">
            <h3 style="margin: 0 0 20px 0; color: var(--primary-dark);">Device Analytics</h3>
            <div style="position: relative; height: 300px; width: 100%;">
                <canvas id="iotChart"></canvas>
            </div>
        </div>
        <div class="form-card" style="text-align: center;">
            <div style="width: 80px; height: 80px; background: linear-gradient(135deg, var(--primary-dark), var(--accent-teal)); border-radius: 50%; margin: 0 auto 15px; display: flex; align-items: center; justify-content: center; color: white; font-size: 32px; font-weight: bold;">
                {{ user_profile.display_name[0] | upper }}
            </div>
            <h3 style="margin: 0;">{{ user_profile.display_name }}</h3>
            <p style="color: #888; font-size: 13px; margin: 5px 0 20px;">{{ user_profile.email }}</p>
            <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; text-align: left; font-size: 12px; margin-bottom: 15px;">
                <strong>Member Since:</strong> {{ user_profile.created_at }}
            </div>
            <a href="{{ url_for('settings') }}" class="button button-secondary" style="width: 100%;">
                <i class="fas fa-cog"></i> Account Settings
            </a>
        </div>
    </div>

    <div>
        <h3 style="margin-bottom: 20px; color: var(--primary-dark);">Saved Bookmarks</h3>
        <div class="project-grid">
            {% for proyek in daftar_proyek %}
                <div class="project-card" style="height: auto;">
                    <span class="category-badge">{{ proyek.data.kategori }}</span>
                    <h4 style="margin: 0 0 10px 0;"><a href="{{ url_for('project_detail', project_id=proyek.id) }}">{{ proyek.data.nama }}</a></h4>
                    <form action="{{ url_for('toggle_bookmark', project_id=proyek.id) }}" method="POST">
                        <input type="hidden" name="source_page" value="dashboard">
                        <button type="submit" class="button-secondary" style="width: 100%; font-size: 11px; padding: 6px;"><i class="fas fa-trash-alt"></i> Remove</button>
                    </form>
                </div>
            {% else %}
                <div class="form-card" style="grid-column: 1/-1; text-align: center; padding: 30px; border-style: dashed;">
                    <p style="color: #999;">Belum ada proyek disimpan.</p>
                </div>
            {% endfor %}
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        const ctx = document.getElementById('iotChart').getContext('2d');
        let gradient = ctx.createLinearGradient(0, 0, 0, 400);
        gradient.addColorStop(0, 'rgba(0, 191, 165, 0.4)');
        gradient.addColorStop(1, 'rgba(0, 191, 165, 0.0)');
        new Chart(ctx, {
            type: 'line',
            data: {
                labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                datasets: [{
                    label: 'Traffic', data: [12, 19, 15, 25, 22, 30, 45],
                    backgroundColor: gradient, borderColor: '#00bfa5', fill: true, tension: 0.4
                }]
            },
            options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } } }
        });
    </script>
{% endblock %}